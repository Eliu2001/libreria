<style>
.books-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 3rem 0;
  margin: -1rem -1rem 2rem -1rem;
  text-align: center;
  border-radius: 0 0 20px 20px;
}

.books-table {
  background: white;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.table thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.table tbody tr {
  transition: background-color 0.3s ease;
}

.table tbody tr:hover {
  background-color: #f8f9fa;
}

.buy-form {
  display: flex;
  gap: 10px;
  align-items: center;
}

.stock-badge {
  font-size: 1.1rem;
  padding: 0.5rem 1rem;
}

.book-name {
  font-weight: 600;
  color: #333;
}
</style>

<div class="books-header">
  <h1>ğŸ“š CatÃ¡logo de Libros</h1>
  <p class="lead">Encuentra tu prÃ³xima gran lectura</p>
</div>

<div class="container">
  {{#if (eq agregado 'exito')}}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong>âœ… Â¡Producto agregado!</strong> El libro se agregÃ³ correctamente a tu carrito.
      <a href="/carrito" class="alert-link">Ver carrito</a>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {{/if}}

  <!-- Barra de BÃºsqueda -->
  <div class="card mb-4">
    <div class="card-body">
      <form action="/libros" method="GET" class="row g-3">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text">ğŸ”</span>
            <input 
              type="text" 
              name="search" 
              class="form-control form-control-lg" 
              placeholder="Buscar por nombre de libro o autor..."
              value="{{searchTerm}}"
              autocomplete="off"
            >
          </div>
        </div>
        <div class="col-md-4">
          <select name="category" class="form-select form-select-lg">
            <option value="">ğŸ“ Todas las categorÃ­as</option>
            {{#each categories}}
              <option value="{{this.id}}" {{#if (eq ../categoryId (toString this.id))}}selected{{/if}}>{{this.nombre}}</option>
            {{/each}}
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary btn-lg w-100">Buscar</button>
        </div>
      </form>
      
      {{#if isSearching}}
        <div class="mt-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted">
              {{#if (gt resultCount 0)}}
                Se encontraron <strong>{{resultCount}}</strong> resultado(s)
              {{else}}
                No se encontraron resultados
              {{/if}}
            </span>
            <a href="/libros" class="btn btn-sm btn-outline-secondary">
              âœ–ï¸ Limpiar filtros
            </a>
          </div>
        </div>
      {{/if}}
    </div>
  </div>

  <div class="books-table">
    <table class="table table-hover mb-0">
      <thead>
        <tr>
          <th>ğŸ“– Nombre</th>
          <th>ğŸ“ CategorÃ­as</th>
          <th>ğŸ’° Precio</th>
          <th>ğŸ“¦ Stock Disponible</th>
          <th style="width: 350px;">ğŸ›’ Agregar al Carrito</th>
        </tr>
      </thead>
      <tbody>
        {{#each books}}
          <tr>
            <td class="book-name">
              {{this.nombre}}
              {{#if this.autor}}
                <br><small class="text-muted">por {{this.autor}}</small>
              {{/if}}
            </td>
            <td>
              {{#if this.categories.length}}
                {{#each this.categories}}
                  <span class="badge bg-secondary me-1">{{this.nombre}}</span>
                {{/each}}
              {{else}}
                <span class="text-muted">Sin categorÃ­a</span>
              {{/if}}
            </td>
            <td>
              <strong class="text-success">${{this.precio}}</strong>
            </td>
            <td>
              {{#if (gt this.cantidad_disponible 5)}}
                <span class="badge bg-success stock-badge">{{this.cantidad_disponible}} disponibles</span>
              {{else if (gt this.cantidad_disponible 0)}}
                <span class="badge bg-warning stock-badge">{{this.cantidad_disponible}} disponibles</span>
              {{else}}
                <span class="badge bg-danger stock-badge">Agotado</span>
              {{/if}}
            </td>
            <td>
              {{#if (gt this.cantidad_disponible 0)}}
                <form action="/carrito/agregar" method="POST" class="buy-form">
                  <input type="hidden" name="bookId" value="{{this.id}}">
                  <input name="cantidad" type="number" min="1" max="{{this.cantidad_disponible}}" value="1" class="form-control" style="width: 100px;" required>
                  <button class="btn btn-success">
                    ğŸ›’ Agregar al Carrito
                  </button>
                </form>
              {{else}}
                <button class="btn btn-secondary" disabled>No disponible</button>
              {{/if}}
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  {{#unless books.length}}
    <div class="alert alert-warning text-center mt-4">
      {{#if isSearching}}
        <h4>ğŸ” No se encontraron libros</h4>
        <p>No hay libros que coincidan con "<strong>{{searchTerm}}</strong>"</p>
        <a href="/libros" class="btn btn-primary">Ver todos los libros</a>
      {{else}}
        <h4>ğŸ“š No hay libros disponibles en este momento</h4>
        <p>Por favor, vuelve mÃ¡s tarde.</p>
      {{/if}}
    </div>
  {{/unless}}
</div>
